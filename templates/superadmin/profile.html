{% extends "_base.html" %}

{% block content %}
<main class="relative h-full max-h-screen transition-all duration-200 ease-in-out xl:ml-68 rounded-xl">
  <!-- Navbar -->
  <nav class="relative flex flex-wrap items-center justify-between px-0 py-2 mx-6 transition-all ease-in shadow-none duration-250 rounded-2xl lg:flex-nowrap lg:justify-start" navbar-main navbar-scroll="false">
    <div class="flex items-center justify-between w-full px-4 py-1 mx-auto flex-wrap-inherit">
      <nav>
        <!-- breadcrumb -->
        <ol class="flex flex-wrap pt-1 mr-12 bg-transparent rounded-lg sm:mr-16">
          <li class="text-sm leading-normal">
            <a class="text-white opacity-50" href="javascript:;">Pages</a>
          </li>
          <li class="text-sm pl-2 capitalize leading-normal text-white before:float-left before:pr-2 before:text-white before:content-['/']" aria-current="page">Profile</li>
        </ol>
        <h6 class="mb-0 font-bold text-white capitalize">Profile Management</h6>
      </nav>
    </div>
  </nav>

  <div class="relative w-full mx-auto mt-60">
    <div class="relative flex flex-col flex-auto min-w-0 p-4 mx-6 overflow-hidden break-words bg-white border-0 dark:bg-slate-850 dark:shadow-dark-xl shadow-3xl rounded-2xl bg-clip-border">
      <div class="flex flex-wrap -mx-3">
        <div class="flex-none w-auto max-w-full px-3">
          <div class="relative inline-flex items-center justify-center text-white transition-all duration-200 ease-in-out text-base h-19 w-19 rounded-xl">
            <img src="{{ url_for('static', filename='assets/img/team-1.jpg') }}" alt="profile_image" class="w-full shadow-2xl rounded-xl" />
          </div>
        </div>
        <div class="flex-none w-auto max-w-full px-3 my-auto">
          <div class="h-full">
            <h5 class="mb-1 dark:text-white">{{ current_user.employee.first_name }} {{ current_user.employee.last_name }}</h5>
            <p class="mb-0 font-semibold leading-normal dark:text-white dark:opacity-60 text-sm">Super Administrator</p>
          </div>
        </div>
        <div class="w-full max-w-full px-3 mx-auto mt-4 sm:my-auto sm:mr-0 md:w-1/2 md:flex-none lg:w-4/12">
          <div class="relative right-0">
            <ul class="relative flex flex-wrap p-1 list-none bg-gray-50 rounded-xl" nav-pills role="tablist">
              <li class="z-30 flex-auto text-center">
                <a class="z-30 flex items-center justify-center w-full px-0 py-1 mb-0 transition-all ease-in-out border-0 rounded-lg bg-inherit text-slate-700" nav-link active href="javascript:;" role="tab" aria-selected="true">
                  <i class="ni ni-app"></i>
                  <span class="ml-2">Profile</span>
                </a>
              </li>
              <li class="z-30 flex-auto text-center">
                <a class="z-30 flex items-center justify-center w-full px-0 py-1 mb-0 transition-all ease-in-out border-0 rounded-lg bg-inherit text-slate-700" nav-link href="javascript:;" role="tab" aria-selected="false">
                  <i class="ni ni-email-83"></i>
                  <span class="ml-2">Settings</span>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="w-full p-6 mx-auto">
    <div class="flex flex-wrap -mx-3">
      <div class="w-full max-w-full px-3 shrink-0 md:w-8/12 md:flex-0">
        <div class="relative flex flex-col min-w-0 break-words bg-white border-0 shadow-xl dark:bg-slate-850 dark:shadow-dark-xl rounded-2xl bg-clip-border">
          <div class="border-black/12.5 rounded-t-2xl border-b-0 border-solid p-6 pb-0">
            <div class="flex items-center">
              <p class="mb-0 dark:text-white/80">Edit Profile</p>
              <button type="button" class="inline-block px-8 py-2 mb-4 ml-auto font-bold leading-normal text-center text-white align-middle transition-all ease-in bg-blue-500 border-0 rounded-lg shadow-md cursor-pointer text-xs tracking-tight-rem hover:shadow-xs hover:-translate-y-px active:opacity-85">Save Changes</button>
            </div>
          </div>
          <div class="flex-auto p-6">
            <p class="leading-normal uppercase dark:text-white dark:opacity-60 text-sm">User Information</p>
            <div class="flex flex-wrap -mx-3">
              <div class="w-full max-w-full px-3 shrink-0 md:w-6/12 md:flex-0">
                <div class="mb-4">
                  <label for="username" class="inline-block mb-2 ml-1 font-bold text-xs text-slate-700 dark:text-white/80">Username</label>
                  <input type="text" name="username" value="{{ current_user.username }}" class="focus:shadow-primary-outline dark:bg-slate-850 dark:text-white text-sm leading-5.6 ease block w-full appearance-none rounded-lg border border-solid border-gray-300 bg-white bg-clip-padding px-3 py-2 font-normal text-gray-700 outline-none transition-all placeholder:text-gray-500 focus:border-blue-500 focus:outline-none" />
                </div>
              </div>
              <div class="w-full max-w-full px-3 shrink-0 md:w-6/12 md:flex-0">
                <div class="mb-4">
                  <label for="email" class="inline-block mb-2 ml-1 font-bold text-xs text-slate-700 dark:text-white/80">Email address</label>
                  <input type="email" name="email" value="{{ current_user.employee.email or '' }}" class="focus:shadow-primary-outline dark:bg-slate-850 dark:text-white text-sm leading-5.6 ease block w-full appearance-none rounded-lg border border-solid border-gray-300 bg-white bg-clip-padding px-3 py-2 font-normal text-gray-700 outline-none transition-all placeholder:text-gray-500 focus:border-blue-500 focus:outline-none" />
                </div>
              </div>
              <div class="w-full max-w-full px-3 shrink-0 md:w-6/12 md:flex-0">
                <div class="mb-4">
                  <label for="first_name" class="inline-block mb-2 ml-1 font-bold text-xs text-slate-700 dark:text-white/80">First name</label>
                  <input type="text" name="first_name" value="{{ current_user.employee.first_name or '' }}" class="focus:shadow-primary-outline dark:bg-slate-850 dark:text-white text-sm leading-5.6 ease block w-full appearance-none rounded-lg border border-solid border-gray-300 bg-white bg-clip-padding px-3 py-2 font-normal text-gray-700 outline-none transition-all placeholder:text-gray-500 focus:border-blue-500 focus:outline-none" />
                </div>
              </div>
              <div class="w-full max-w-full px-3 shrink-0 md:w-6/12 md:flex-0">
                <div class="mb-4">
                  <label for="last_name" class="inline-block mb-2 ml-1 font-bold text-xs text-slate-700 dark:text-white/80">Last name</label>
                  <input type="text" name="last_name" value="{{ current_user.employee.last_name or '' }}" class="focus:shadow-primary-outline dark:bg-slate-850 dark:text-white text-sm leading-5.6 ease block w-full appearance-none rounded-lg border border-solid border-gray-300 bg-white bg-clip-padding px-3 py-2 font-normal text-gray-700 outline-none transition-all placeholder:text-gray-500 focus:border-blue-500 focus:outline-none" />
                </div>
              </div>
            </div>
            <hr class="h-px mx-0 my-4 bg-transparent border-0 opacity-25 bg-gradient-to-r from-transparent via-black/40 to-transparent dark:bg-gradient-to-r dark:from-transparent dark:via-white dark:to-transparent " />
            
            <p class="leading-normal uppercase dark:text-white dark:opacity-60 text-sm">Contact Information</p>
            <div class="flex flex-wrap -mx-3">
              <div class="w-full max-w-full px-3 shrink-0 md:w-full md:flex-0">
                <div class="mb-4">
                  <label for="address" class="inline-block mb-2 ml-1 font-bold text-xs text-slate-700 dark:text-white/80">Address</label>
                  <input type="text" name="address" value="{{ current_user.employee.address or '' }}" class="focus:shadow-primary-outline dark:bg-slate-850 dark:text-white text-sm leading-5.6 ease block w-full appearance-none rounded-lg border border-solid border-gray-300 bg-white bg-clip-padding px-3 py-2 font-normal text-gray-700 outline-none transition-all placeholder:text-gray-500 focus:border-blue-500 focus:outline-none" />
                </div>
              </div>
              <div class="w-full max-w-full px-3 shrink-0 md:w-4/12 md:flex-0">
                <div class="mb-4">
                  <label for="phone" class="inline-block mb-2 ml-1 font-bold text-xs text-slate-700 dark:text-white/80">Phone</label>
                  <input type="text" name="phone" value="{{ current_user.employee.phone or '' }}" class="focus:shadow-primary-outline dark:bg-slate-850 dark:text-white text-sm leading-5.6 ease block w-full appearance-none rounded-lg border border-solid border-gray-300 bg-white bg-clip-padding px-3 py-2 font-normal text-gray-700 outline-none transition-all placeholder:text-gray-500 focus:border-blue-500 focus:outline-none" />
                </div>
              </div>
              <div class="w-full max-w-full px-3 shrink-0 md:w-4/12 md:flex-0">
                <div class="mb-4">
                  <label for="employee_id" class="inline-block mb-2 ml-1 font-bold text-xs text-slate-700 dark:text-white/80">Employee ID</label>
                  <input type="text" name="employee_id" value="{{ current_user.employee.employee_id or '' }}" class="focus:shadow-primary-outline dark:bg-slate-850 dark:text-white text-sm leading-5.6 ease block w-full appearance-none rounded-lg border border-solid border-gray-300 bg-white bg-clip-padding px-3 py-2 font-normal text-gray-700 outline-none transition-all placeholder:text-gray-500 focus:border-blue-500 focus:outline-none" />
                </div>
              </div>
              <div class="w-full max-w-full px-3 shrink-0 md:w-4/12 md:flex-0">
                <div class="mb-4">
                  <label for="hire_date" class="inline-block mb-2 ml-1 font-bold text-xs text-slate-700 dark:text-white/80">Hire Date</label>
                  <input type="date" name="hire_date" value="{{ current_user.employee.hire_date.strftime('%Y-%m-%d') if current_user.employee.hire_date else '' }}" class="focus:shadow-primary-outline dark:bg-slate-850 dark:text-white text-sm leading-5.6 ease block w-full appearance-none rounded-lg border border-solid border-gray-300 bg-white bg-clip-padding px-3 py-2 font-normal text-gray-700 outline-none transition-all placeholder:text-gray-500 focus:border-blue-500 focus:outline-none" />
                </div>
              </div>
            </div>
            <hr class="h-px mx-0 my-4 bg-transparent border-0 opacity-25 bg-gradient-to-r from-transparent via-black/40 to-transparent dark:bg-gradient-to-r dark:from-transparent dark:via-white dark:to-transparent " />

            <p class="leading-normal uppercase dark:text-white dark:opacity-60 text-sm">Emergency Contact</p>
            <div class="flex flex-wrap -mx-3">
              <div class="w-full max-w-full px-3 shrink-0 md:w-4/12 md:flex-0">
                <div class="mb-4">
                  <label for="next_of_kin_name" class="inline-block mb-2 ml-1 font-bold text-xs text-slate-700 dark:text-white/80">Next of Kin Name</label>
                  <input type="text" name="next_of_kin_name" value="{{ current_user.employee.next_of_kin_name or '' }}" class="focus:shadow-primary-outline dark:bg-slate-850 dark:text-white text-sm leading-5.6 ease block w-full appearance-none rounded-lg border border-solid border-gray-300 bg-white bg-clip-padding px-3 py-2 font-normal text-gray-700 outline-none transition-all placeholder:text-gray-500 focus:border-blue-500 focus:outline-none" />
                </div>
              </div>
              <div class="w-full max-w-full px-3 shrink-0 md:w-4/12 md:flex-0">
                <div class="mb-4">
                  <label for="next_of_kin_phone" class="inline-block mb-2 ml-1 font-bold text-xs text-slate-700 dark:text-white/80">Next of Kin Phone</label>
                  <input type="text" name="next_of_kin_phone" value="{{ current_user.employee.next_of_kin_phone or '' }}" class="focus:shadow-primary-outline dark:bg-slate-850 dark:text-white text-sm leading-5.6 ease block w-full appearance-none rounded-lg border border-solid border-gray-300 bg-white bg-clip-padding px-3 py-2 font-normal text-gray-700 outline-none transition-all placeholder:text-gray-500 focus:border-blue-500 focus:outline-none" />
                </div>
              </div>
              <div class="w-full max-w-full px-3 shrink-0 md:w-4/12 md:flex-0">
                <div class="mb-4">
                  <label for="next_of_kin_relationship" class="inline-block mb-2 ml-1 font-bold text-xs text-slate-700 dark:text-white/80">Relationship</label>
                  <input type="text" name="next_of_kin_relationship" value="{{ current_user.employee.next_of_kin_relationship or '' }}" class="focus:shadow-primary-outline dark:bg-slate-850 dark:text-white text-sm leading-5.6 ease block w-full appearance-none rounded-lg border border-solid border-gray-300 bg-white bg-clip-padding px-3 py-2 font-normal text-gray-700 outline-none transition-all placeholder:text-gray-500 focus:border-blue-500 focus:outline-none" />
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="w-full max-w-full px-3 mt-6 shrink-0 md:w-4/12 md:flex-0 md:mt-0">
        <div class="relative flex flex-col min-w-0 break-words bg-white border-0 shadow-xl dark:bg-slate-850 dark:shadow-dark-xl rounded-2xl bg-clip-border">
          <img class="w-full rounded-t-2xl" src="{{ url_for('static', filename='assets/img/bg-profile.jpg') }}" alt="profile cover image">
          <div class="flex flex-wrap justify-center -mx-3">
            <div class="w-4/12 max-w-full px-3 flex-0 ">
              <div class="mb-6 -mt-6 lg:mb-0 lg:-mt-16">
                <a href="javascript:;">
                  <img class="h-auto max-w-full border-2 border-white border-solid rounded-circle" src="{{ url_for('static', filename='assets/img/team-2.jpg') }}" alt="profile image">
                </a>
              </div>
            </div>
          </div>
          <div class="border-black/12.5 rounded-t-2xl p-6 text-center pt-0 pb-6 lg:pt-2 lg:pb-4">
            <div class="flex justify-between">
              <button type="button" class="hidden px-8 py-2 font-bold leading-normal text-center text-white align-middle transition-all ease-in border-0 rounded-lg shadow-md cursor-pointer text-xs bg-cyan-500 lg:block tracking-tight-rem hover:shadow-xs hover:-translate-y-px active:opacity-85">Edit Photo</button>
              <button type="button" class="block px-8 py-2 font-bold leading-normal text-center text-white align-middle transition-all ease-in border-0 rounded-lg shadow-md cursor-pointer text-xs bg-cyan-500 lg:hidden tracking-tight-rem hover:shadow-xs hover:-translate-y-px active:opacity-85">
                <i class="ni ni-collection text-2.8"></i>
              </button>
              <button type="button" onclick="openChangePasswordModal()" class="hidden px-8 py-2 font-bold leading-normal text-center text-white align-middle transition-all ease-in border-0 rounded-lg shadow-md cursor-pointer text-xs bg-slate-700 lg:block tracking-tight-rem hover:shadow-xs hover:-translate-y-px active:opacity-85">Change Password</button>
              <button type="button" onclick="openChangePasswordModal()" class="block px-8 py-2 font-bold leading-normal text-center text-white align-middle transition-all ease-in border-0 rounded-lg shadow-md cursor-pointer text-xs bg-slate-700 lg:hidden tracking-tight-rem hover:shadow-xs hover:-translate-y-px active:opacity-85">
                <i class="ni ni-email-83 text-2.8"></i>
              </button>
              <!-- Test button for debugging -->
              <button type="button" onclick="testModal()" class="px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 ml-2">
                Test JS
              </button>
            </div>
          </div>

          <div class="flex-auto p-6 pt-0">
            <div class="flex flex-wrap -mx-3">
              <div class="w-full max-w-full px-3 flex-1-0">
                <div class="flex justify-center">
                  <div class="grid text-center">
                    <span class="font-bold dark:text-white text-lg">{{ current_user.employee.employee_id or 'N/A' }}</span>
                    <span class="leading-normal dark:text-white text-sm opacity-80">Employee ID</span>
                  </div>
                  <div class="grid mx-6 text-center">
                    <span class="font-bold dark:text-white text-lg">{{ current_user.role|title }}</span>
                    <span class="leading-normal dark:text-white text-sm opacity-80">Role</span>
                  </div>
                  <div class="grid text-center">
                    <span class="font-bold dark:text-white text-lg">{{ current_user.created_at.strftime('%Y-%m-%d') if current_user.created_at else 'N/A' }}</span>
                    <span class="leading-normal dark:text-white text-sm opacity-80">Joined</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="mt-6 text-center">
              <h5 class="dark:text-white ">
                {{ current_user.employee.first_name }} {{ current_user.employee.last_name }}
                {% if current_user.employee.date_of_birth %}
                <span class="font-light">, {{ current_user.employee.date_of_birth.strftime('%Y')|int - 2024 + 24 }}</span>
                {% endif %}
              </h5>
              <div class="mb-2 font-semibold leading-relaxed text-base dark:text-white/80 text-slate-700">
                <i class="mr-2 dark:text-white ni ni-pin-3"></i>
                {{ current_user.employee.address or 'Address not provided' }}
              </div>
              <div class="mt-6 mb-2 font-semibold leading-relaxed text-base dark:text-white/80 text-slate-700">
                <i class="mr-2 dark:text-white ni ni-briefcase-24"></i>
                Super Administrator - KFactor WebApp
              </div>
              <div class="dark:text-white/80">
                <i class="mr-2 dark:text-white ni ni-email-83"></i>
                {{ current_user.employee.email or 'Email not provided' }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- Change Password Modal -->
<div id="changePasswordModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
  <div class="bg-white dark:bg-slate-850 rounded-lg shadow-xl max-w-md w-full mx-4">
    <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-slate-700">
      <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Change Password</h3>
      <button onclick="closeChangePasswordModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
        <i class="ni ni-fat-remove text-xl"></i>
      </button>
    </div>
    <form id="changePasswordForm" class="p-6">
      <div class="mb-4">
        <label for="current_password" class="block text-sm font-medium text-gray-700 dark:text-white mb-2">Current Password</label>
        <input type="password" id="current_password" name="current_password" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-slate-800 dark:border-slate-700 dark:text-white">
      </div>
      <div class="mb-4">
        <label for="new_password" class="block text-sm font-medium text-gray-700 dark:text-white mb-2">New Password</label>
        <input type="password" id="new_password" name="new_password" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-slate-800 dark:border-slate-700 dark:text-white">
      </div>
      <div class="mb-6">
        <label for="confirm_password" class="block text-sm font-medium text-gray-700 dark:text-white mb-2">Confirm New Password</label>
        <input type="password" id="confirm_password" name="confirm_password" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-slate-800 dark:border-slate-700 dark:text-white">
      </div>
      <div class="flex justify-end space-x-3">
        <button type="button" onclick="closeChangePasswordModal()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 dark:bg-slate-700 dark:text-white dark:hover:bg-slate-600">
          Cancel
        </button>
        <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700">
          Change Password
        </button>
      </div>
    </form>
  </div>
</div>

<script>
function openChangePasswordModal() {
  console.log('Opening change password modal...');
  const modal = document.getElementById('changePasswordModal');
  if (modal) {
    modal.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
    console.log('Modal opened successfully');
  } else {
    console.error('Modal element not found');
  }
}

function closeChangePasswordModal() {
  console.log('Closing change password modal...');
  const modal = document.getElementById('changePasswordModal');
  if (modal) {
    modal.classList.add('hidden');
    document.body.style.overflow = 'auto';
    const form = document.getElementById('changePasswordForm');
    if (form) {
      form.reset();
    }
    console.log('Modal closed successfully');
  } else {
    console.error('Modal element not found');
  }
}

// Wait for DOM to be loaded
document.addEventListener('DOMContentLoaded', function() {
  console.log('DOM loaded, setting up change password form...');
  
  const form = document.getElementById('changePasswordForm');
  if (form) {
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      console.log('Form submitted...');
      
      const formData = new FormData(this);
      
      fetch('{{ url_for("superadmin_routes.change_password") }}', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        console.log('Response:', data);
        if (data.success) {
          alert('Password changed successfully!');
          closeChangePasswordModal();
        } else {
          alert('Error: ' + data.message);
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while changing password.');
      });
    });
    console.log('Form event listener added');
  } else {
    console.error('Change password form not found');
  }

  // Close modal when clicking outside
  const modal = document.getElementById('changePasswordModal');
  if (modal) {
    modal.addEventListener('click', function(e) {
      if (e.target === this) {
        closeChangePasswordModal();
      }
    });
    console.log('Modal click outside listener added');
  } else {
    console.error('Modal element not found for click outside listener');
  }
});

// Test function to check if JavaScript is working
function testModal() {
  console.log('Test function called');
  alert('JavaScript is working!');
}
</script>
{% endblock %} 