{% extends "baseDriver.html" %}

{% block content %}
<main class="relative h-full max-h-screen transition-all duration-200 ease-in-out xl:ml-68 rounded-xl">
  <!-- Navbar -->
  <nav class="relative flex flex-wrap items-center justify-between px-0 py-2 mx-6 transition-all ease-in shadow-none duration-250 rounded-2xl lg:flex-nowrap lg:justify-start" navbar-main navbar-scroll="false">
    <div class="flex items-center justify-between w-full px-4 py-1 mx-auto flex-wrap-inherit">
      <nav>
        <!-- breadcrumb -->
        <ol class="flex flex-wrap pt-1 mr-12 bg-transparent rounded-lg sm:mr-16">
          <li class="text-sm leading-normal">
            <a class="text-white opacity-50" href="javascript:;">Pages</a>
          </li>
          <li class="text-sm pl-2 capitalize leading-normal text-white before:float-left before:pr-2 before:text-white before:content-['/']" aria-current="page">Job Cards</li>
        </ol>
        <h6 class="mb-0 font-bold text-white capitalize">Job Card Management</h6>
      </nav>
    </div>
  </nav>

  <div class="w-full px-6 py-6 mx-auto">

  <!-- Job Cards Tabs -->
  <div class="bg-white rounded-lg shadow">
    <div class="border-b border-gray-200">
      <nav class="-mb-px flex space-x-8 px-6" aria-label="Tabs">
        <button class="border-blue-500 text-orange-600 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm active-tab" 
                onclick="showTab('all')">
          All Jobs ({{ jobs|length }})
        </button>
        <button class="border-transparent text-orange-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" 
                onclick="showTab('assigned')">
          Assigned
        </button>
        <button class="border-transparent text-orange-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" 
                onclick="showTab('in_progress')">
          In Progress
        </button>
        <button class="border-transparent text-orange-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" 
                onclick="showTab('in_transit')">
          In Transit
        </button>
        <button class="border-transparent text-orange-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" 
                onclick="showTab('delivered')">
          Delivered
        </button>
      </nav>
    </div>

    <div class="p-6">
      <!-- All Jobs Tab -->
      <div id="all" class="tab-content">
        <div class="space-y-6">
          {% for job in jobs %}
          <div class="border rounded-lg p-6 hover:shadow-md transition-shadow">
            <div class="flex justify-between items-start mb-4">
              <div>
                <h3 class="text-lg font-semibold text-gray-900">{{ job.job_number }}</h3>
                <!-- <p class="text-sm text-gray-600">{{ job.pickup_location }} â†’ {{ job.delivery_location }}</p> -->
                <p class="text-xs text-gray-500">Created: {{ job.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
              </div>
              <div class="flex items-center space-x-2">
                <span class="px-3 py-1 text-xs rounded-full 
                  {% if job.status == 'assigned' %}bg-blue-100 text-blue-800
                  {% elif job.status == 'in_progress' %}bg-yellow-100 text-yellow-800
                  {% elif job.status == 'picked_up' %}bg-orange-100 text-orange-800
                  {% elif job.status == 'in_transit' %}bg-purple-100 text-purple-800
                  {% elif job.status == 'delivered' %}bg-green-100 text-green-800
                  {% elif job.status == 'cancelled' %}bg-red-100 text-red-800
                  {% else %}bg-gray-100 text-gray-800{% endif %}">
                  {{ job.status|replace('_', ' ')|title }}
                </span>
                <a href="{{ url_for('driver_routes.driver_job_card_detail', job_card_id=job.id) }}" 
                   class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                  View Details
                </a>
              </div>
            </div>

            <!-- Vehicle Information -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
              <div>
                <p class="text-xs text-gray-500">Assigned Car</p>
                <p class="text-sm font-medium">{{ job.car.model if job.car else 'N/A' }}</p>
                {% if job.car %}
                  <p class="text-xs text-gray-600">{{ job.car.registration_number }}</p>
                {% endif %}
              </div>
              <div>
                <p class="text-xs text-gray-500">Assigned Trailer</p>
                <p class="text-sm font-medium">{{ job.trailer.model if job.trailer else 'N/A' }}</p>
                {% if job.trailer %}
                  <p class="text-xs text-gray-600">{{ job.trailer.registration_number }}</p>
                {% endif %}
              </div>
            </div>

            <!-- Notes Section -->
            {% if job.notes %}
            <div class="border-t pt-4">
              <h4 class="text-sm font-semibold text-gray-900 mb-3">Notes</h4>
              <div class="p-3 bg-gray-50 rounded-lg">
                <p class="text-sm text-gray-700">{{ job.notes }}</p>
              </div>
            </div>
            {% endif %}
          </div>
          {% endfor %}
        </div>
      </div>

      <!-- Assigned Jobs Tab -->
      <div id="assigned" class="tab-content hidden">
        <div class="space-y-6">
          {% for job in jobs if job.status == 'assigned' %}
          <div class="border rounded-lg p-6 hover:shadow-md transition-shadow">
            <div class="flex justify-between items-start mb-4">
              <div>
                <h3 class="text-lg font-semibold text-gray-900">{{ job.job_number }}</h3>
                <p class="text-xs text-gray-500">Created: {{ job.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
              </div>
              <div class="flex items-center space-x-2">
                <span class="px-3 py-1 text-xs rounded-full bg-blue-100 text-blue-800">
                  Assigned
                </span>
                <a href="{{ url_for('driver_routes.driver_job_card_detail', job_card_id=job.id) }}" 
                   class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                  View Details
                </a>
              </div>
            </div>

            <!-- Vehicle Information -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
              <div>
                <p class="text-xs text-gray-500">Assigned Car</p>
                <p class="text-sm font-medium">{{ job.car.model if job.car else 'N/A' }}</p>
                {% if job.car %}
                  <p class="text-xs text-gray-600">{{ job.car.registration_number }}</p>
                {% endif %}
              </div>
              <div>
                <p class="text-xs text-gray-500">Assigned Trailer</p>
                <p class="text-sm font-medium">{{ job.trailer.model if job.trailer else 'N/A' }}</p>
                {% if job.trailer %}
                  <p class="text-xs text-gray-600">{{ job.trailer.registration_number }}</p>
                {% endif %}
              </div>
            </div>

            <!-- Notes Section -->
            {% if job.notes %}
            <div class="border-t pt-4">
              <h4 class="text-sm font-semibold text-gray-900 mb-3">Notes</h4>
              <div class="p-3 bg-gray-50 rounded-lg">
                <p class="text-sm text-gray-700">{{ job.notes }}</p>
              </div>
            </div>
            {% endif %}
          </div>
          {% endfor %}
        </div>
      </div>

      <!-- In Progress Jobs Tab -->
      <div id="in_progress" class="tab-content hidden">
        <div class="space-y-6">
          {% for job in jobs if job.status == 'in_progress' %}
          <div class="border rounded-lg p-6 hover:shadow-md transition-shadow">
            <div class="flex justify-between items-start mb-4">
              <div>
                <h3 class="text-lg font-semibold text-gray-900">{{ job.job_number }}</h3>
                <p class="text-xs text-gray-500">Created: {{ job.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
              </div>
              <div class="flex items-center space-x-2">
                <span class="px-3 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800">
                  In Progress
                </span>
                <a href="{{ url_for('driver_routes.driver_job_card_detail', job_card_id=job.id) }}" 
                   class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                  View Details
                </a>
              </div>
            </div>

            <!-- Vehicle Information -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
              <div>
                <p class="text-xs text-gray-500">Assigned Car</p>
                <p class="text-sm font-medium">{{ job.car.model if job.car else 'N/A' }}</p>
                {% if job.car %}
                  <p class="text-xs text-gray-600">{{ job.car.registration_number }}</p>
                {% endif %}
              </div>
              <div>
                <p class="text-xs text-gray-500">Assigned Trailer</p>
                <p class="text-sm font-medium">{{ job.trailer.model if job.trailer else 'N/A' }}</p>
                {% if job.trailer %}
                  <p class="text-xs text-gray-600">{{ job.trailer.registration_number }}</p>
                {% endif %}
              </div>
            </div>

            <!-- Notes Section -->
            {% if job.notes %}
            <div class="border-t pt-4">
              <h4 class="text-sm font-semibold text-gray-900 mb-3">Notes</h4>
              <div class="p-3 bg-gray-50 rounded-lg">
                <p class="text-sm text-gray-700">{{ job.notes }}</p>
              </div>
            </div>
            {% endif %}
          </div>
          {% endfor %}
        </div>
      </div>

      <!-- In Transit Jobs Tab -->
      <div id="in_transit" class="tab-content hidden">
        <div class="space-y-6">
          {% for job in jobs if job.status == 'in_transit' %}
          <div class="border rounded-lg p-6 hover:shadow-md transition-shadow">
            <div class="flex justify-between items-start mb-4">
              <div>
                <h3 class="text-lg font-semibold text-gray-900">{{ job.job_number }}</h3>
                <p class="text-xs text-gray-500">Created: {{ job.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
              </div>
              <div class="flex items-center space-x-2">
                <span class="px-3 py-1 text-xs rounded-full bg-purple-100 text-purple-800">
                  In Transit
                </span>
                <a href="{{ url_for('driver_routes.driver_job_card_detail', job_card_id=job.id) }}" 
                   class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                  View Details
                </a>
              </div>
            </div>

            <!-- Vehicle Information -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
              <div>
                <p class="text-xs text-gray-500">Assigned Car</p>
                <p class="text-sm font-medium">{{ job.car.model if job.car else 'N/A' }}</p>
                {% if job.car %}
                  <p class="text-xs text-gray-600">{{ job.car.registration_number }}</p>
                {% endif %}
              </div>
              <div>
                <p class="text-xs text-gray-500">Assigned Trailer</p>
                <p class="text-sm font-medium">{{ job.trailer.model if job.trailer else 'N/A' }}</p>
                {% if job.trailer %}
                  <p class="text-xs text-gray-600">{{ job.trailer.registration_number }}</p>
                {% endif %}
              </div>
            </div>

            <!-- Notes Section -->
            {% if job.notes %}
            <div class="border-t pt-4">
              <h4 class="text-sm font-semibold text-gray-900 mb-3">Notes</h4>
              <div class="p-3 bg-gray-50 rounded-lg">
                <p class="text-sm text-gray-700">{{ job.notes }}</p>
              </div>
            </div>
            {% endif %}
          </div>
          {% endfor %}
        </div>
      </div>

      <!-- Delivered Jobs Tab -->
      <div id="delivered" class="tab-content hidden">
        <div class="space-y-6">
          {% for job in jobs if job.status == 'delivered' %}
          <div class="border rounded-lg p-6 hover:shadow-md transition-shadow">
            <div class="flex justify-between items-start mb-4">
              <div>
                <h3 class="text-lg font-semibold text-gray-900">{{ job.job_number }}</h3>
                <p class="text-xs text-gray-500">Created: {{ job.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
              </div>
              <div class="flex items-center space-x-2">
                <span class="px-3 py-1 text-xs rounded-full bg-green-100 text-green-800">
                  Delivered
                </span>
                <a href="{{ url_for('driver_routes.driver_job_card_detail', job_card_id=job.id) }}" 
                   class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                  View Details
                </a>
              </div>
            </div>

            <!-- Vehicle Information -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
              <div>
                <p class="text-xs text-gray-500">Assigned Car</p>
                <p class="text-sm font-medium">{{ job.car.model if job.car else 'N/A' }}</p>
                {% if job.car %}
                  <p class="text-xs text-gray-600">{{ job.car.registration_number }}</p>
                {% endif %}
              </div>
              <div>
                <p class="text-xs text-gray-500">Assigned Trailer</p>
                <p class="text-sm font-medium">{{ job.trailer.model if job.trailer else 'N/A' }}</p>
                {% if job.trailer %}
                  <p class="text-xs text-gray-600">{{ job.trailer.registration_number }}</p>
                {% endif %}
              </div>
            </div>

            <!-- Notes Section -->
            {% if job.notes %}
            <div class="border-t pt-4">
              <h4 class="text-sm font-semibold text-gray-900 mb-3">Notes</h4>
              <div class="p-3 bg-gray-50 rounded-lg">
                <p class="text-sm text-gray-700">{{ job.notes }}</p>
              </div>
            </div>
            {% endif %}
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
  </div>
</main>

<script>
function showTab(tabName) {
  console.log('Switching to tab:', tabName);
  
  // Hide all tab contents
  const tabContents = document.querySelectorAll('.tab-content');
  tabContents.forEach(content => {
    content.classList.add('hidden');
  });

  // Remove active class from all tab buttons
  const tabButtons = document.querySelectorAll('nav button');
  tabButtons.forEach(button => {
    button.classList.remove('border-blue-500', 'text-orange-600');
    button.classList.add('border-transparent', 'text-orange-500');
  });

  // Show selected tab content
  const selectedTab = document.getElementById(tabName);
  if (selectedTab) {
    selectedTab.classList.remove('hidden');
    console.log('Tab content shown:', tabName);
  } else {
    console.error('Tab content not found:', tabName);
  }

  // Add active class to selected tab button
  const activeButton = document.querySelector(`button[onclick="showTab('${tabName}')"]`);
  if (activeButton) {
    activeButton.classList.remove('border-transparent', 'text-orange-500');
    activeButton.classList.add('border-blue-500', 'text-orange-600');
    console.log('Active button updated');
  } else {
    console.error('Active button not found for tab:', tabName);
  }
}

// Initialize the first tab as active when page loads
document.addEventListener('DOMContentLoaded', function() {
  console.log('DOM loaded, initializing tabs...');
  showTab('all');
});
</script>
{% endblock %} 